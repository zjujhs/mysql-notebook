## 优化方案概述
软件层面：

- SQL调优
  - 投入少，收益大
- 表结构优化
  - 如存储冗余字段避免关联
- 架构优化
  - 增加实例组成集群
- 分库分表

硬件层面：
- 提升硬件性能
  - 一般不用

## 分库分表
### 策略

#### 垂直拆分与水平拆分

垂直拆分：拆为结构不同的库或表

- 如一张user表拆分为`user`和`user_detail`

水平拆分：划分数据，结构不变

#### 单库内拆分与多库拆分

多库拆分性能更高。

### 复杂性

#### 跨库关联查询
解决方案：

- 字段冗余，避免join操作
- 全局表：基础表在每个数据库中都放一份
- 数据抽象：通过ETL等将数据汇合聚集，生成新的表
- 应用层组装：将基础数据查出来，通过应用程序计算组装

#### 分布式事务

解决方案：

- 基于可靠消息（MQ）的解决方案
- 两阶段事务提交
- 柔性事务

#### 排序、分页、函数计算

采用分片思路：先在各个分片上执行相应的函数，然后将各个分片的结果集进行汇总和再次计算，最终得到结果。

#### 分布式ID

解决方案：

- UUID
- 基于数据库自增单独维护一张ID表
- 号段模式
- Redis缓存
- 雪花算法(Snowflake)
- 百度uid-generator
- 美团Leaf
- 滴滴Tinyid

#### 多数据源

从多个数据库或多个子表获取数据，一般的解决思路有：

- 客户端适配
- 代理层适配

常用的中间件：

- shardingsphere
- Mycat

## 分片策略

### 哈希取模分片(或id取模)

优点：数据分布均匀
缺点：无法支持范围查询.

### 范围分片

根据值落在哪一范围确定属于哪一分片

优点：支持范围查询
缺点：数据分布不均匀

### 哈希 + 范围取模分片

### 列表分片

根据预先定义好的列表将数据进行分片，每个分片包含列表中的一部分值

优点：可以手动控制数据分配
缺点：需要不断维护列表

### 轮询分片

将数据均匀轮流分配到不同分片

优点：避免了数据倾斜
缺点：需要维护全局状态，可能成为性能瓶颈

### 随机分片

优点：避免数据倾斜
缺点：不适用于需要有序查询的场景


